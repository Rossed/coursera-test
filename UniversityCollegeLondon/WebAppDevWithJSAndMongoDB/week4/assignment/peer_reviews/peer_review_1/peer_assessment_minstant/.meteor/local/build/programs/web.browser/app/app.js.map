{"version":3,"sources":["meteor://ðŸ’»app/client/template.about.js","meteor://ðŸ’»app/client/template.chat.js","meteor://ðŸ’»app/client/template.layout.js","meteor://ðŸ’»app/client/template.minstant.js","meteor://ðŸ’»app/client/template.navbar.js","meteor://ðŸ’»app/client/chat.js","meteor://ðŸ’»app/client/main.js","meteor://ðŸ’»app/lib/collections.js","meteor://ðŸ’»app/lib/methods.js","meteor://ðŸ’»app/lib/routes.js"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA,uH;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wH;;;;;;;;;;;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wH;;;;;;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wH;;;;;;;;;;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wH;;;;;;;;;;;ACfA,SAAS,SAAT,CAAmB,OAAnB,CAA2B;AACzB;AAAS,wBAAU;AACjB,UAAI,OAAO,MAAM,OAAN,CAAc,EAAC,KAAI,QAAQ,GAAR,CAAY,QAAZ,CAAJ,EAAf,CAAP,CADa;AAEjB,UAAI,IAAJ,EAAU;AACR,eAAO,KAAK,QAAL,CADC;OAAV,MAEO;AACL,eAAO,EAAP,CADK;OAFP;KAFO;;;KAAT;AAQA;AAAU,wBAAW;AACnB,UAA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","file":"/app.js","sourcesContent":["\nTemplate.__checkName(\"about\");\nTemplate[\"about\"] = new Template(\"Template.about\", (function() {\n  var view = this;\n  return HTML.Raw('<h2>This is a chat</h2>\\n  <p>Try to use emojis</p>\\n  <p><a href=\"http://www.webpagefx.com/tools/emoji-cheat-sheet/\">emojis cheatsheet</a></p>');\n}));\n","\nTemplate.__checkName(\"chat_page\");\nTemplate[\"chat_page\"] = new Template(\"Template.chat_page\", (function() {\n  var view = this;\n  return [ HTML.H2(\"Type in the box below to send a message to \", Blaze.View(\"lookup:chatWith.profile.username\", function() {\n    return Spacebars.mustache(Spacebars.dot(view.lookup(\"chatWith\"), \"profile\", \"username\"));\n  }), \"!\"), \"\\n\t\", HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t\", HTML.DIV({\n    \"class\": \"well well-lg\"\n  }, \"\\n\t\t\t\", Blaze.Each(function() {\n    return Spacebars.call(view.lookup(\"messages\"));\n  }, function() {\n    return [ \"\\n\t\t\t\", Spacebars.include(view.lookupTemplate(\"chat_message\")), \"\\n\t\t\t\" ];\n  }), \"\\n\t\t\t\"), \"\\n\t\t\"), \"\\n\t\"), HTML.Raw('\\n    <div class=\"row\">\\n\t\t<div class=\"col-md-12\">\\n\t\t\t<form class=\"js-send-chat\">\\n\t\t\t\t<div class=\"input-group\">\\n\t\t\t\t\t<input class=\"input form-control\" type=\"text\" name=\"chat\" placeholder=\"type a message here...\">\\n\t\t      <span class=\"input-group-btn\">\\n\t\t        <button class=\"btn btn-default\" type=\"submit\">Send</button>\\n\t\t      </span>\\n\t\t    </div>\\n\t\t\t</form>\\n\t\t</div>\\n\t</div>') ];\n}));\n\nTemplate.__checkName(\"chat_message\");\nTemplate[\"chat_message\"] = new Template(\"Template.chat_message\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": function() {\n      return [ \"\\n\t\trow\\n\t\t\", Blaze.If(function() {\n        return Spacebars.call(view.lookup(\"isOwner\"));\n      }, function() {\n        return \"\\n\t\t\tbg-success\\n\t\t\";\n      }), \"\\n\\n\t\" ];\n    }\n  }, \"\\n\t  \", HTML.DIV({\n    \"class\": \"col-xs-3 col-md-2\"\n  }, \"\\n\t    \", HTML.A({\n    href: \"#\",\n    \"class\": \"thumbnail\"\n  }, \"\\n\t      \", HTML.IMG({\n    \"class\": \"media-object\",\n    src: function() {\n      return [ \"/\", Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"profile\", \"avatar\")) ];\n    },\n    alt: function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"profile\", \"username\"));\n    }\n  }), \"\\n\t    \"), \"\\n\t  \"), \"\\n\t  \", HTML.DIV({\n    \"class\": \"col-xs-9 col-md-10\"\n  }, \"\\n\t    \", HTML.H4({\n    \"class\": \"media-heading\"\n  }, \"\\n\t\t\t\t\", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"isOwner\"));\n  }, function() {\n    return \"\\n\t\t\t\t\tYou said\\n\t\t\t  \";\n  }, function() {\n    return [ \"\\n\t\t\t\t\t\", Blaze.View(\"lookup:user.profile.username\", function() {\n      return Spacebars.mustache(Spacebars.dot(view.lookup(\"user\"), \"profile\", \"username\"));\n    }), \" said\\n\t\t\t  \" ];\n  }), \"\\n\t\t\t\t\", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"createdOn\"));\n  }, function() {\n    return [ \"\\n\t\t\t\t\t\", Blaze.View(\"lookup:formatedDate\", function() {\n      return Spacebars.mustache(view.lookup(\"formatedDate\"));\n    }), \"\\n\t\t\t\t\" ];\n  }), \"\\n\t\t\t\"), \"\\n\t\t\t\", Spacebars.include(view.lookupTemplate(\"emoji\"), function() {\n    return [ \"\\n\t\t  \t\", Blaze.View(\"lookup:text\", function() {\n      return Spacebars.mustache(view.lookup(\"text\"));\n    }), \"\\n\t\t\t\" ];\n  }), \"\\n\t  \"), \"\\n\t\");\n}));\n","\nTemplate.body.addContent((function() {\n  var view = this;\n  return \"\";\n}));\nMeteor.startup(Template.body.renderToDocument);\n\nTemplate.__checkName(\"ApplicationLayout\");\nTemplate[\"ApplicationLayout\"] = new Template(\"Template.ApplicationLayout\", (function() {\n  var view = this;\n  return [ Blaze._TemplateWith(function() {\n    return \"header\";\n  }, function() {\n    return Spacebars.include(view.lookupTemplate(\"yield\"));\n  }), \"\\n\\n\t\", HTML.DIV({\n    \"class\": \"container\"\n  }, \"\\n\t\", Blaze._TemplateWith(function() {\n    return \"main\";\n  }, function() {\n    return Spacebars.include(view.lookupTemplate(\"yield\"));\n  }), \"\\n\t\") ];\n}));\n","\nTemplate.__checkName(\"lobby_page\");\nTemplate[\"lobby_page\"] = new Template(\"Template.lobby_page\", (function() {\n  var view = this;\n  return Spacebars.include(view.lookupTemplate(\"available_user_list\"));\n}));\n\nTemplate.__checkName(\"available_user_list\");\nTemplate[\"available_user_list\"] = new Template(\"Template.available_user_list\", (function() {\n  var view = this;\n  return [ HTML.Raw(\"<h2>Choose someone to chat with:</h2>\\n\t\"), HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"currentUser\"));\n  }, function() {\n    return [ \"\\n\t\t\", Blaze.Each(function() {\n      return Spacebars.call(view.lookup(\"users\"));\n    }, function() {\n      return [ \"\\n\t\t\", Spacebars.include(view.lookupTemplate(\"available_user\")), \"\\n\t\t\" ];\n    }), \"\\n\t\" ];\n  }, function() {\n    return [ \"\\n\t\t\", HTML.H3(\"Please login\"), \"\\n\t\" ];\n  }), \"\\n\") ];\n}));\n\nTemplate.__checkName(\"available_user\");\nTemplate[\"available_user\"] = new Template(\"Template.available_user\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"col-xs-6 col-md-2\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"user_avatar\"\n  }, \"\\n\t\t\t\", Blaze.If(function() {\n    return Spacebars.dataMustache(view.lookup(\"isMyUser\"), view.lookup(\"_id\"));\n  }, function() {\n    return [ \"\\n\t\t\t\", HTML.DIV({\n      \"class\": \"bg-success\"\n    }, Blaze.View(\"lookup:getUsername\", function() {\n      return Spacebars.mustache(view.lookup(\"getUsername\"), view.lookup(\"_id\"));\n    }), \" (YOU)\\n\t\t\t\t\", HTML.BR(), \"\\n\t\t\t\t\", HTML.IMG({\n      src: function() {\n        return [ \"/\", Spacebars.mustache(Spacebars.dot(view.lookup(\"profile\"), \"avatar\")) ];\n      },\n      \"class\": \"avatar_img\"\n    }), \"\\n\t\t\t\"), \"\\n\t\t\t\" ];\n  }, function() {\n    return [ \"\\n\t\t\t\", HTML.A({\n      href: function() {\n        return [ \"/chat/\", Spacebars.mustache(view.lookup(\"_id\")) ];\n      }\n    }, \"\\n\t\t\t\t\", Blaze.View(\"lookup:getUsername\", function() {\n      return Spacebars.mustache(view.lookup(\"getUsername\"), view.lookup(\"_id\"));\n    }), \"\\n\t\t\t\t\", HTML.BR(), \"\\n\t\t\t\t\", HTML.IMG({\n      src: function() {\n        return [ \"/\", Spacebars.mustache(Spacebars.dot(view.lookup(\"profile\"), \"avatar\")) ];\n      },\n      \"class\": \"avatar_img\"\n    }), \"\\n\t\t\t\"), \"\\n\t\t\t\" ];\n  }), \"\\n\t\t\"), \"\\n\t\");\n}));\n","\nTemplate.__checkName(\"navbar\");\nTemplate[\"navbar\"] = new Template(\"Template.navbar\", (function() {\n  var view = this;\n  return HTML.NAV({\n    \"class\": \"navbar navbar-default navbar-fixed-top\"\n  }, \"\\n  \", HTML.DIV({\n    \"class\": \"container-fluid\"\n  }, \"\\n    \", HTML.Raw('<div class=\"navbar-header\">\\n      <button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#navbar\" aria-expanded=\"false\">\\n        <span class=\"sr-only\">Toggle navigation</span>\\n        <span class=\"icon-bar\"></span>\\n        <span class=\"icon-bar\"></span>\\n        <span class=\"icon-bar\"></span>\\n      </button>\\n      <a class=\"navbar-brand\" href=\"/\">\\n        Minstant!\\n      </a>\\n    </div>'), \"\\n    \", HTML.DIV({\n    \"class\": \"collapse navbar-collapse\",\n    id: \"navbar\"\n  }, \"\\n      \", HTML.Raw('<ul class=\"nav navbar-nav \">\\n        <li><a href=\"/about\">About</a></li>\\n      </ul>'), \"\\n      \", HTML.DIV({\n    \"class\": \"nav navbar-nav navbar-right\"\n  }, \"\\n        \", Spacebars.include(view.lookupTemplate(\"loginButtons\")), \"\\n      \"), \"\\n    \"), \"\\n  \"), \"\\n\");\n}));\n","Template.chat_page.helpers({\n  messages:function(){\n    var chat = Chats.findOne({_id:Session.get(\"chatId\")});\n    if (chat) {\n      return chat.messages;\n    } else {\n      return [];\n    }\n  },\n  chatWith: function (){\n    var chat = Chats.findOne({_id:Session.get(\"chatId\")});\n    if (chat) {\n      if (chat.user1Id === Meteor.userId()){\n        return Meteor.users.findOne(chat.user2Id);\n      } else {\n        return Meteor.users.findOne(chat.user1Id);\n      }\n    }\n    return ;\n  }\n})\nTemplate.chat_page.events({\n// this event fires when the user sends a message on the chat page\n'submit .js-send-chat':function(event){\n  // stop the form from triggering a page reload\n  event.preventDefault();\n  Meteor.call(\"sendMessage\",\n    Session.get(\"chatId\"),\n    event.target.chat.value,\n    function(error, result){\n      event.target.chat.value = \"\";\n    }\n  );\n}\n})\n\nTemplate.chat_message.helpers({\n  isOwner: function() {\n    return this.userId === Meteor.userId();\n  },\n  user: function() {\n    return Meteor.users.findOne(this.userId);\n  },\n  formatedDate: function() {\n    return moment(this.createdOn).fromNow();\n  }\n});\n","///\n// helper functions\n///\nTemplate.available_user_list.helpers({\n  users:function(){\n    return Meteor.users.find();\n  }\n})\nTemplate.available_user.helpers({\n  getUsername:function(userId){\n    user = Meteor.users.findOne({_id:userId});\n    return user.profile.username;\n  },\n  isMyUser:function(userId){\n    if (userId == Meteor.userId()){\n      return true;\n    }\n    else {\n      return false;\n    }\n  }\n})\n","Chats = new Mongo.Collection(\"chats\");\n\nif (Meteor.isServer) {\n\n  Meteor.publish(\"chats\", function(){\n    return Chats.find({$or:[\n      {user1Id:this.userId},\n      {user2Id:this.userId}\n    ]});\n  });\n\n  Meteor.publish(\"users\", function(){\n    return Meteor.users.find()\n  });\n\n  Meteor.publish('emojis', function() {\n    // Here you can choose to publish a subset of all emojis\n    // if you'd like to.\n    return Emojis.find();\n  });\n}\n\nif (Meteor.isClient) {\n  Meteor.subscribe('chats');\n  Meteor.subscribe('users');\n  Meteor.subscribe('emojis');\n}\n","Meteor.methods({\n  \"getChat\": function (otherUserId) {\n    // var otherUserId = this.params._id;\n    // find a chat that has two users that match current user id\n    // and the requested user id\n    if (this.userId) {\n      var filter = {$or:[\n        {user1Id:this.userId, user2Id:otherUserId},\n        {user2Id:this.userId, user1Id:otherUserId}\n      ]};\n      var chat = Chats.findOne(filter);\n      if (!chat){// no chat matching the filter - need to insert a new one\n        return Chats.insert({user1Id:Meteor.userId(), user2Id:otherUserId});\n      }\n      else {// there is a chat going already - use that.\n        return chat._id;\n      }\n    }\n  },\n  \"sendMessage\": function(chatId, message) {\n    if (this.userId) {\n      var chat = Chats.findOne({_id:chatId});\n      if (chat){// ok - we have a chat to use\n        var msgs = chat.messages; // pull the messages property\n        if (!msgs){// no messages yet, create a new array\n          msgs = [];\n        }\n        // is a good idea to insert data straight from the form\n        // (i.e. the user) into the database?? certainly not.\n        // push adds the message to the end of the array\n        msgs.push({\n          text: message,\n          userId: this.userId,\n          createdOn: new Date(),\n        });\n        // put the messages array onto the chat object\n        chat.messages = msgs;\n        // update the chat object in the database.\n        Chats.update(chat._id, chat);\n      }\n    }\n  }\n});\n","// set up the main template the the router will use to build pages\nRouter.configure({\n  layoutTemplate: 'ApplicationLayout'\n});\n// specify the top level route, the page users see when they arrive at the site\nRouter.route('/', function () {\n  this.render(\"navbar\", {to:\"header\"});\n  this.render(\"lobby_page\", {to:\"main\"});\n});\n\n// specify a route that allows the current user to chat to another users\nRouter.route('/chat/:_id', function () {\n  Meteor.call(\"getChat\", this.params._id, function(error, result){\n    Session.set(\"chatId\",result);\n  });\n  // // the user they want to chat to has id equal to\n  // // the id sent in after /chat/...\n  // var otherUserId = this.params._id;\n  // // find a chat that has two users that match current user id\n  // // and the requested user id\n  // var filter = {$or:[\n  //             {user1Id:Meteor.userId(), user2Id:otherUserId},\n  //             {user2Id:Meteor.userId(), user1Id:otherUserId}\n  //             ]};\n  // var chat = Chats.findOne(filter);\n  // if (!chat){// no chat matching the filter - need to insert a new one\n  //   chatId = Chats.insert({user1Id:Meteor.userId(), user2Id:otherUserId});\n  // }\n  // else {// there is a chat going already - use that.\n  //   chatId = chat._id;\n  // }\n  // if (chatId){// looking good, save the id to the session\n  //   Session.set(\"chatId\",chatId);\n  // }\n  this.render(\"navbar\", {to:\"header\"});\n  this.render(\"chat_page\", {to:\"main\"});\n});\nRouter.route('/about', function () {\n  this.render(\"navbar\", {to:\"header\"});\n  this.render(\"about\", {to:\"main\"});\n});\n"]}