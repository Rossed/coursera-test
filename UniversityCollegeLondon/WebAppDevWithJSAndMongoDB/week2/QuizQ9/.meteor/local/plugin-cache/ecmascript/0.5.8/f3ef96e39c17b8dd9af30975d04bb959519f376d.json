{"metadata":{"usedHelpers":["classCallCheck","inherits","possibleConstructorReturn"],"marked":[],"modules":{"imports":[{"source":"meteor/templating","imported":["Template"],"specifiers":[{"kind":"named","imported":"Template","local":"Template"}]},{"source":"meteor/reactive-var","imported":["ReactiveVar"],"specifiers":[{"kind":"named","imported":"ReactiveVar","local":"ReactiveVar"}]},{"source":"meteor/blaze","imported":["Blaze"],"specifiers":[{"kind":"named","imported":"Blaze","local":"Blaze"}]},{"source":"./loadBCSocket","imported":[],"specifiers":[]},{"source":"share/webclient/share.uncompressed","imported":[],"specifiers":[]},{"source":"./textarea","imported":[],"specifiers":[]}],"exports":{"exported":["ShareJSConnector"],"specifiers":[{"kind":"local","local":"ShareJSConnector","exported":"ShareJSConnector"}]}}},"options":{"filename":"/packages/mizzao:sharejs/sharejs-client.js","filenameRelative":"/packages/mizzao:sharejs/sharejs-client.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/mizzao:sharejs/sharejs-client.js.map","sourceFileName":"/packages/mizzao:sharejs/sharejs-client.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"sharejs-client"},"ignored":false,"code":"module.export({ShareJSConnector:function(){return ShareJSConnector}});var _possibleConstructorReturn;module.import('babel-runtime/helpers/possibleConstructorReturn',{\"default\":function(v){_possibleConstructorReturn=v}});var _inherits;module.import('babel-runtime/helpers/inherits',{\"default\":function(v){_inherits=v}});var _classCallCheck;module.import('babel-runtime/helpers/classCallCheck',{\"default\":function(v){_classCallCheck=v}});var Template;module.import('meteor/templating',{\"Template\":function(v){Template=v}});var ReactiveVar;module.import('meteor/reactive-var',{\"ReactiveVar\":function(v){ReactiveVar=v}});var Blaze;module.import('meteor/blaze',{\"Blaze\":function(v){Blaze=v}});module.import('./loadBCSocket');module.import('share/webclient/share.uncompressed');module.import('./textarea');\n\n\n/**\n * Created by dsichau on 27.04.16.\n */\n\n\n\n\n\n\n\n\nvar ShareJSConnector = function () {\n    ShareJSConnector.prototype.getOptions = function getOptions() {\n        return {\n            origin: '//' + window.location.host + '/channel'\n        };\n    };\n\n    function ShareJSConnector(parentView) {\n        var _this = this;\n\n        _classCallCheck(this, ShareJSConnector);\n\n        var docIdVar = new ReactiveVar();\n\n        parentView.onViewReady(function () {\n            return this.autorun(function () {\n                var data = Blaze.getData();\n                return docIdVar.set(data.docid);\n            });\n        });\n\n        parentView.onViewDestroyed(function () {\n            _this.destroy();\n        });\n\n        this.isCreated = false;\n        this.docIdVar = docIdVar;\n        // Configure any callbacks if specified\n        var params = Blaze.getData(parentView);\n        this.configCallback = params.onRender;\n        this.connectCallback = params.onConnect;\n    }\n\n    ShareJSConnector.prototype.create = function create() {\n        if (this.isCreated) {\n            throw new Error(\"Already created\");\n        }\n        var connector = this;\n        this.isCreated = true;\n        this.view = this.createView();\n        this.view.onViewReady(function () {\n            connector.rendered(this.firstNode());\n            return this.autorun(function () {\n                var docId;\n                docId = connector.docIdVar.get();\n                connector.disconnect();\n                if (docId) {\n                    return connector.connect(docId);\n                }\n            });\n        });\n        return this.view;\n    };\n\n    ShareJSConnector.prototype.rendered = function rendered(element) {\n        this.element = element;\n    };\n\n    ShareJSConnector.prototype.connect = function connect(docId, element) {\n        var _this2 = this;\n\n        this.connectingId = docId;\n        sharejs.open(docId, 'text', this.getOptions(), function (error, doc) {\n            if (error) {\n                console.log(error);\n                return;\n            }\n            // Don't attach if re-render happens too quickly and we' re trying to\n            // connect to a different document now.\n            if (_this2.connectingId !== doc.name) {\n                doc.close();\n            } else {\n                _this2.attach(doc);\n            }\n        });\n    };\n\n    ShareJSConnector.prototype.attach = function attach(doc) {\n        this.doc = doc;\n    };\n\n    ShareJSConnector.prototype.disconnect = function disconnect() {\n        if (this.doc) {\n            this.doc.close();\n            this.doc = null;\n        }\n    };\n\n    ShareJSConnector.prototype.destroy = function destroy() {\n        if (this.isDestroyed) {\n            throw new Error(\"Already destroyed\");\n        }\n        this.disconnect();\n        this.view = null;\n        this.isDestroyed = true;\n    };\n\n    return ShareJSConnector;\n}();\n\nvar ShareJSTextConnector = function (_ShareJSConnector) {\n    _inherits(ShareJSTextConnector, _ShareJSConnector);\n\n    function ShareJSTextConnector() {\n        _classCallCheck(this, ShareJSTextConnector);\n\n        return _possibleConstructorReturn(this, _ShareJSConnector.apply(this, arguments));\n    }\n\n    ShareJSTextConnector.prototype.createView = function createView() {\n        return Blaze.With(Blaze.getData(), function () {\n            return Template._sharejsText;\n        });\n    };\n\n    ShareJSTextConnector.prototype.rendered = function rendered(element) {\n        _ShareJSConnector.prototype.rendered.call(this, element);\n        this.textarea = element;\n        if (typeof this.configCallback === \"function\") {\n            this.configCallback(this.textarea);\n        }\n    };\n\n    ShareJSTextConnector.prototype.connect = function connect() {\n        this.textarea.disabled = true;\n        _ShareJSConnector.prototype.connect.call(this, this.docIdVar.get());\n    };\n\n    ShareJSTextConnector.prototype.attach = function attach(doc) {\n        _ShareJSConnector.prototype.attach.call(this, doc);\n        doc.attach_textarea(this.textarea);\n        this.textarea.disabled = false;\n        if (typeof this.connectCallback === \"function\") {\n            this.connectCallback(this.textarea);\n        }\n    };\n\n    ShareJSTextConnector.prototype.disconnect = function disconnect() {\n        var ref = this.textarea;\n        if (ref != null) {\n            if (typeof ref.detach_share === \"function\") {\n                ref.detach_share();\n            }\n        }\n        _ShareJSConnector.prototype.disconnect.call(this);\n    };\n\n    ShareJSTextConnector.prototype.destroy = function destroy() {\n        _ShareJSConnector.prototype.destroy.call(this);\n        // Meteor._debug \"destroying textarea editor\"\n        this.textarea = null;\n    };\n\n    return ShareJSTextConnector;\n}(ShareJSConnector);\n\nTemplate.registerHelper(\"sharejsText\", new Template('sharejsText', function () {\n    return new ShareJSTextConnector(this).create();\n}));","ast":null,"map":{"version":3,"sources":["/packages/mizzao:sharejs/sharejs-client.js"],"names":[],"mappings":"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","file":"/packages/mizzao:sharejs/sharejs-client.js.map","sourcesContent":["/**\n * Created by dsichau on 27.04.16.\n */\nimport { Template } from 'meteor/templating'\nimport { ReactiveVar } from 'meteor/reactive-var'\nimport { Blaze } from 'meteor/blaze'\n\nimport './loadBCSocket'\nimport 'share/webclient/share.uncompressed'\nimport './textarea'\n\nexport class ShareJSConnector {\n\n    getOptions() {\n        return {\n            origin: '//' + window.location.host + '/channel'\n        };\n    };\n\n    constructor(parentView) {\n        const docIdVar = new ReactiveVar();\n\n        parentView.onViewReady(function() {\n            return this.autorun(function() {\n                const data = Blaze.getData();\n                return docIdVar.set(data.docid);\n            });\n        });\n\n        parentView.onViewDestroyed(()=> {\n            this.destroy()\n        });\n\n        this.isCreated = false;\n        this.docIdVar = docIdVar;\n        // Configure any callbacks if specified\n        const params = Blaze.getData(parentView);\n        this.configCallback = params.onRender;\n        this.connectCallback = params.onConnect;\n    }\n\n    create() {\n        if (this.isCreated) {\n            throw new Error(\"Already created\");\n        }\n        const connector = this;\n        this.isCreated = true;\n        this.view = this.createView();\n        this.view.onViewReady(function() {\n            connector.rendered(this.firstNode());\n            return this.autorun(function() {\n                var docId;\n                docId = connector.docIdVar.get();\n                connector.disconnect();\n                if (docId) {\n                    return connector.connect(docId);\n                }\n            });\n        });\n        return this.view;\n    }\n\n    rendered(element) {\n        this.element = element;\n    }\n\n    connect(docId, element) {\n        this.connectingId = docId;\n        sharejs.open(docId, 'text', this.getOptions(), (error, doc) => {\n            if (error) {\n                console.log(error);\n                return\n            }\n            // Don't attach if re-render happens too quickly and we' re trying to\n            // connect to a different document now.\n            if(this.connectingId !== doc.name) {\n                doc.close();\n            }\n            else {\n                this.attach(doc);\n            }\n        });\n    }\n\n    attach(doc) {\n        this.doc = doc;\n    }\n\n    disconnect() {\n        if(this.doc) {\n            this.doc.close();\n            this.doc = null;\n        }\n    }\n\n    destroy() {\n        if(this.isDestroyed) {\n            throw new Error(\"Already destroyed\")\n        }\n        this.disconnect();\n        this.view = null;\n        this.isDestroyed = true;\n    }\n}\n\nclass ShareJSTextConnector extends ShareJSConnector {\n\n    createView() {\n        return Blaze.With(Blaze.getData(),function() {\n            return Template._sharejsText;\n        })\n    }\n\n    rendered(element) {\n        super.rendered(element);\n        this.textarea = element;\n        if (typeof this.configCallback === \"function\") {\n            this.configCallback(this.textarea);\n        }\n    }\n\n    connect() {\n        this.textarea.disabled = true;\n        super.connect(this.docIdVar.get());\n    }\n\n    attach(doc) {\n        super.attach(doc);\n        doc.attach_textarea(this.textarea);\n        this.textarea.disabled = false;\n        if (typeof this.connectCallback === \"function\") {\n            this.connectCallback(this.textarea);\n        }\n    }\n\n    disconnect() {\n        const ref = this.textarea;\n        if (ref != null) {\n            if (typeof ref.detach_share === \"function\") {\n                ref.detach_share();\n            }\n        }\n        super.disconnect();\n    }\n\n    destroy() {\n        super.destroy();\n        // Meteor._debug \"destroying textarea editor\"\n        this.textarea = null\n    }\n}\n\nTemplate.registerHelper(\"sharejsText\", new Template('sharejsText', function() {\n    return new ShareJSTextConnector(this).create()\n}));"]},"hash":"f3ef96e39c17b8dd9af30975d04bb959519f376d"}
