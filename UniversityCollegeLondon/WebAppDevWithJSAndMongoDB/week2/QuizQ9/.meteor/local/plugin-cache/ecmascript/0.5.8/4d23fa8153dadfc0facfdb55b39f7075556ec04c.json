{"metadata":{"usedHelpers":["classCallCheck","inherits","possibleConstructorReturn"],"marked":[],"modules":{"imports":[{"source":"meteor/templating","imported":["Template"],"specifiers":[{"kind":"named","imported":"Template","local":"Template"}]},{"source":"meteor/reactive-var","imported":["ReactiveVar"],"specifiers":[{"kind":"named","imported":"ReactiveVar","local":"ReactiveVar"}]},{"source":"meteor/blaze","imported":["Blaze"],"specifiers":[{"kind":"named","imported":"Blaze","local":"Blaze"}]},{"source":"./loadBCSocket","imported":[],"specifiers":[]},{"source":"share/webclient/share.uncompressed","imported":[],"specifiers":[]},{"source":"./textarea","imported":[],"specifiers":[]}],"exports":{"exported":["ShareJSConnector"],"specifiers":[{"kind":"local","local":"ShareJSConnector","exported":"ShareJSConnector"}]}}},"options":{"filename":"/packages/mizzao:sharejs/sharejs-client.js","filenameRelative":"/packages/mizzao:sharejs/sharejs-client.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/mizzao:sharejs/sharejs-client.js.map","sourceFileName":"/packages/mizzao:sharejs/sharejs-client.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"sharejs-client"},"ignored":false,"code":"module.export({ShareJSConnector:function(){return ShareJSConnector}});var _possibleConstructorReturn;module.import('babel-runtime/helpers/possibleConstructorReturn',{\"default\":function(v){_possibleConstructorReturn=v}});var _inherits;module.import('babel-runtime/helpers/inherits',{\"default\":function(v){_inherits=v}});var _classCallCheck;module.import('babel-runtime/helpers/classCallCheck',{\"default\":function(v){_classCallCheck=v}});var Template;module.import('meteor/templating',{\"Template\":function(v){Template=v}});var ReactiveVar;module.import('meteor/reactive-var',{\"ReactiveVar\":function(v){ReactiveVar=v}});var Blaze;module.import('meteor/blaze',{\"Blaze\":function(v){Blaze=v}});module.import('./loadBCSocket');module.import('share/webclient/share.uncompressed');module.import('./textarea');\n\n\n/**\n * Created by dsichau on 27.04.16.\n */\n\n\n\n\n\n\n\n\nvar ShareJSConnector = function () {\n    ShareJSConnector.prototype.getOptions = function () {\n        function getOptions() {\n            return {\n                origin: '//' + window.location.host + '/channel'\n            };\n        }\n\n        return getOptions;\n    }();\n\n    function ShareJSConnector(parentView) {\n        var _this = this;\n\n        _classCallCheck(this, ShareJSConnector);\n\n        var docIdVar = new ReactiveVar();\n\n        parentView.onViewReady(function () {\n            return this.autorun(function () {\n                var data = Blaze.getData();\n                return docIdVar.set(data.docid);\n            });\n        });\n\n        parentView.onViewDestroyed(function () {\n            _this.destroy();\n        });\n\n        this.isCreated = false;\n        this.docIdVar = docIdVar;\n        // Configure any callbacks if specified\n        var params = Blaze.getData(parentView);\n        this.configCallback = params.onRender;\n        this.connectCallback = params.onConnect;\n    }\n\n    ShareJSConnector.prototype.create = function () {\n        function create() {\n            if (this.isCreated) {\n                throw new Error(\"Already created\");\n            }\n            var connector = this;\n            this.isCreated = true;\n            this.view = this.createView();\n            this.view.onViewReady(function () {\n                connector.rendered(this.firstNode());\n                return this.autorun(function () {\n                    var docId;\n                    docId = connector.docIdVar.get();\n                    connector.disconnect();\n                    if (docId) {\n                        return connector.connect(docId);\n                    }\n                });\n            });\n            return this.view;\n        }\n\n        return create;\n    }();\n\n    ShareJSConnector.prototype.rendered = function () {\n        function rendered(element) {\n            this.element = element;\n        }\n\n        return rendered;\n    }();\n\n    ShareJSConnector.prototype.connect = function () {\n        function connect(docId, element) {\n            var _this2 = this;\n\n            this.connectingId = docId;\n            sharejs.open(docId, 'text', this.getOptions(), function (error, doc) {\n                if (error) {\n                    console.log(error);\n                    return;\n                }\n                // Don't attach if re-render happens too quickly and we' re trying to\n                // connect to a different document now.\n                if (_this2.connectingId !== doc.name) {\n                    doc.close();\n                } else {\n                    _this2.attach(doc);\n                }\n            });\n        }\n\n        return connect;\n    }();\n\n    ShareJSConnector.prototype.attach = function () {\n        function attach(doc) {\n            this.doc = doc;\n        }\n\n        return attach;\n    }();\n\n    ShareJSConnector.prototype.disconnect = function () {\n        function disconnect() {\n            if (this.doc) {\n                this.doc.close();\n                this.doc = null;\n            }\n        }\n\n        return disconnect;\n    }();\n\n    ShareJSConnector.prototype.destroy = function () {\n        function destroy() {\n            if (this.isDestroyed) {\n                throw new Error(\"Already destroyed\");\n            }\n            this.disconnect();\n            this.view = null;\n            this.isDestroyed = true;\n        }\n\n        return destroy;\n    }();\n\n    return ShareJSConnector;\n}();\n\nvar ShareJSTextConnector = function (_ShareJSConnector) {\n    _inherits(ShareJSTextConnector, _ShareJSConnector);\n\n    function ShareJSTextConnector() {\n        _classCallCheck(this, ShareJSTextConnector);\n\n        return _possibleConstructorReturn(this, _ShareJSConnector.apply(this, arguments));\n    }\n\n    ShareJSTextConnector.prototype.createView = function () {\n        function createView() {\n            return Blaze.With(Blaze.getData(), function () {\n                return Template._sharejsText;\n            });\n        }\n\n        return createView;\n    }();\n\n    ShareJSTextConnector.prototype.rendered = function () {\n        function rendered(element) {\n            _ShareJSConnector.prototype.rendered.call(this, element);\n            this.textarea = element;\n            if (typeof this.configCallback === \"function\") {\n                this.configCallback(this.textarea);\n            }\n        }\n\n        return rendered;\n    }();\n\n    ShareJSTextConnector.prototype.connect = function () {\n        function connect() {\n            this.textarea.disabled = true;\n            _ShareJSConnector.prototype.connect.call(this, this.docIdVar.get());\n        }\n\n        return connect;\n    }();\n\n    ShareJSTextConnector.prototype.attach = function () {\n        function attach(doc) {\n            _ShareJSConnector.prototype.attach.call(this, doc);\n            doc.attach_textarea(this.textarea);\n            this.textarea.disabled = false;\n            if (typeof this.connectCallback === \"function\") {\n                this.connectCallback(this.textarea);\n            }\n        }\n\n        return attach;\n    }();\n\n    ShareJSTextConnector.prototype.disconnect = function () {\n        function disconnect() {\n            var ref = this.textarea;\n            if (ref != null) {\n                if (typeof ref.detach_share === \"function\") {\n                    ref.detach_share();\n                }\n            }\n            _ShareJSConnector.prototype.disconnect.call(this);\n        }\n\n        return disconnect;\n    }();\n\n    ShareJSTextConnector.prototype.destroy = function () {\n        function destroy() {\n            _ShareJSConnector.prototype.destroy.call(this);\n            // Meteor._debug \"destroying textarea editor\"\n            this.textarea = null;\n        }\n\n        return destroy;\n    }();\n\n    return ShareJSTextConnector;\n}(ShareJSConnector);\n\nTemplate.registerHelper(\"sharejsText\", new Template('sharejsText', function () {\n    return new ShareJSTextConnector(this).create();\n}));","ast":null,"map":{"version":3,"sources":["/packages/mizzao:sharejs/sharejs-client.js"],"names":[],"mappings":"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","file":"/packages/mizzao:sharejs/sharejs-client.js.map","sourcesContent":["/**\n * Created by dsichau on 27.04.16.\n */\nimport { Template } from 'meteor/templating'\nimport { ReactiveVar } from 'meteor/reactive-var'\nimport { Blaze } from 'meteor/blaze'\n\nimport './loadBCSocket'\nimport 'share/webclient/share.uncompressed'\nimport './textarea'\n\nexport class ShareJSConnector {\n\n    getOptions() {\n        return {\n            origin: '//' + window.location.host + '/channel'\n        };\n    };\n\n    constructor(parentView) {\n        const docIdVar = new ReactiveVar();\n\n        parentView.onViewReady(function() {\n            return this.autorun(function() {\n                const data = Blaze.getData();\n                return docIdVar.set(data.docid);\n            });\n        });\n\n        parentView.onViewDestroyed(()=> {\n            this.destroy()\n        });\n\n        this.isCreated = false;\n        this.docIdVar = docIdVar;\n        // Configure any callbacks if specified\n        const params = Blaze.getData(parentView);\n        this.configCallback = params.onRender;\n        this.connectCallback = params.onConnect;\n    }\n\n    create() {\n        if (this.isCreated) {\n            throw new Error(\"Already created\");\n        }\n        const connector = this;\n        this.isCreated = true;\n        this.view = this.createView();\n        this.view.onViewReady(function() {\n            connector.rendered(this.firstNode());\n            return this.autorun(function() {\n                var docId;\n                docId = connector.docIdVar.get();\n                connector.disconnect();\n                if (docId) {\n                    return connector.connect(docId);\n                }\n            });\n        });\n        return this.view;\n    }\n\n    rendered(element) {\n        this.element = element;\n    }\n\n    connect(docId, element) {\n        this.connectingId = docId;\n        sharejs.open(docId, 'text', this.getOptions(), (error, doc) => {\n            if (error) {\n                console.log(error);\n                return\n            }\n            // Don't attach if re-render happens too quickly and we' re trying to\n            // connect to a different document now.\n            if(this.connectingId !== doc.name) {\n                doc.close();\n            }\n            else {\n                this.attach(doc);\n            }\n        });\n    }\n\n    attach(doc) {\n        this.doc = doc;\n    }\n\n    disconnect() {\n        if(this.doc) {\n            this.doc.close();\n            this.doc = null;\n        }\n    }\n\n    destroy() {\n        if(this.isDestroyed) {\n            throw new Error(\"Already destroyed\")\n        }\n        this.disconnect();\n        this.view = null;\n        this.isDestroyed = true;\n    }\n}\n\nclass ShareJSTextConnector extends ShareJSConnector {\n\n    createView() {\n        return Blaze.With(Blaze.getData(),function() {\n            return Template._sharejsText;\n        })\n    }\n\n    rendered(element) {\n        super.rendered(element);\n        this.textarea = element;\n        if (typeof this.configCallback === \"function\") {\n            this.configCallback(this.textarea);\n        }\n    }\n\n    connect() {\n        this.textarea.disabled = true;\n        super.connect(this.docIdVar.get());\n    }\n\n    attach(doc) {\n        super.attach(doc);\n        doc.attach_textarea(this.textarea);\n        this.textarea.disabled = false;\n        if (typeof this.connectCallback === \"function\") {\n            this.connectCallback(this.textarea);\n        }\n    }\n\n    disconnect() {\n        const ref = this.textarea;\n        if (ref != null) {\n            if (typeof ref.detach_share === \"function\") {\n                ref.detach_share();\n            }\n        }\n        super.disconnect();\n    }\n\n    destroy() {\n        super.destroy();\n        // Meteor._debug \"destroying textarea editor\"\n        this.textarea = null\n    }\n}\n\nTemplate.registerHelper(\"sharejsText\", new Template('sharejsText', function() {\n    return new ShareJSTextConnector(this).create()\n}));"]},"hash":"4d23fa8153dadfc0facfdb55b39f7075556ec04c"}
