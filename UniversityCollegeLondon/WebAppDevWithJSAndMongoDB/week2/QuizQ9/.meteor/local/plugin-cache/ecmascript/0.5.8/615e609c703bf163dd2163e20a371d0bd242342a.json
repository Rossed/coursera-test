{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/mizzao:sharejs/textarea.js","filenameRelative":"/packages/mizzao:sharejs/textarea.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/mizzao:sharejs/textarea.js.map","sourceFileName":"/packages/mizzao:sharejs/textarea.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"textarea"},"ignored":false,"code":"// Generated by CoffeeScript 1.6.2\n(function () {\n  var applyChange;\n\n  applyChange = function applyChange(doc, oldval, newval) {\n    var commonEnd, commonStart;\n\n    if (oldval === newval) {\n      return;\n    }\n    commonStart = 0;\n    while (oldval.charAt(commonStart) === newval.charAt(commonStart)) {\n      commonStart++;\n    }\n    commonEnd = 0;\n    while (oldval.charAt(oldval.length - 1 - commonEnd) === newval.charAt(newval.length - 1 - commonEnd) && commonEnd + commonStart < oldval.length && commonEnd + commonStart < newval.length) {\n      commonEnd++;\n    }\n    if (oldval.length !== commonStart + commonEnd) {\n      doc.del(commonStart, oldval.length - commonStart - commonEnd);\n    }\n    if (newval.length !== commonStart + commonEnd) {\n      return doc.insert(commonStart, newval.slice(commonStart, newval.length - commonEnd));\n    }\n  };\n\n  sharejs.extendDoc('attach_textarea', function (elem) {\n    var delete_listener,\n        doc,\n        event,\n        genOp,\n        insert_listener,\n        prevvalue,\n        replaceText,\n        _i,\n        _len,\n        _ref,\n        _this = this;\n\n    doc = this;\n    elem.value = this.getText();\n    prevvalue = elem.value;\n    replaceText = function replaceText(newText, transformCursor) {\n      var newSelection, scrollTop;\n\n      newSelection = [transformCursor(elem.selectionStart), transformCursor(elem.selectionEnd)];\n      scrollTop = elem.scrollTop;\n      elem.value = newText;\n      if (elem.scrollTop !== scrollTop) {\n        elem.scrollTop = scrollTop;\n      }\n      if (window.document.activeElement === elem) {\n        return elem.selectionStart = newSelection[0], elem.selectionEnd = newSelection[1], newSelection;\n      }\n    };\n    this.on('insert', insert_listener = function insert_listener(pos, text) {\n      var transformCursor;\n\n      transformCursor = function transformCursor(cursor) {\n        if (pos < cursor) {\n          return cursor + text.length;\n        } else {\n          return cursor;\n        }\n      };\n      prevvalue = elem.value.replace(/\\r\\n/g, '\\n');\n      return replaceText(prevvalue.slice(0, pos) + text + prevvalue.slice(pos), transformCursor);\n    });\n    this.on('delete', delete_listener = function delete_listener(pos, text) {\n      var transformCursor;\n\n      transformCursor = function transformCursor(cursor) {\n        if (pos < cursor) {\n          return cursor - Math.min(text.length, cursor - pos);\n        } else {\n          return cursor;\n        }\n      };\n      prevvalue = elem.value.replace(/\\r\\n/g, '\\n');\n      return replaceText(prevvalue.slice(0, pos) + prevvalue.slice(pos + text.length), transformCursor);\n    });\n    genOp = function genOp(event) {\n      var onNextTick;\n\n      onNextTick = function onNextTick(fn) {\n        return setTimeout(fn, 0);\n      };\n      return onNextTick(function () {\n        if (elem.value !== prevvalue) {\n          prevvalue = elem.value;\n          return applyChange(doc, doc.getText(), elem.value.replace(/\\r\\n/g, '\\n'));\n        }\n      });\n    };\n    _ref = ['textInput', 'keydown', 'keyup', 'select', 'cut', 'paste'];\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      event = _ref[_i];\n      if (elem.addEventListener) {\n        elem.addEventListener(event, genOp, false);\n      } else {\n        elem.attachEvent('on' + event, genOp);\n      }\n    }\n    return elem.detach_share = function () {\n      var _j, _len1, _ref1, _results;\n\n      _this.removeListener('insert', insert_listener);\n      _this.removeListener('delete', delete_listener);\n      _ref1 = ['textInput', 'keydown', 'keyup', 'select', 'cut', 'paste'];\n      _results = [];\n      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {\n        event = _ref1[_j];\n        if (elem.removeEventListener) {\n          _results.push(elem.removeEventListener(event, genOp, false));\n        } else {\n          _results.push(elem.detachEvent('on' + event, genOp));\n        }\n      }\n      return _results;\n    };\n  });\n}).call(this);","ast":null,"map":{"version":3,"sources":["/packages/mizzao:sharejs/textarea.js"],"names":[],"mappings":"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","file":"/packages/mizzao:sharejs/textarea.js.map","sourcesContent":["// Generated by CoffeeScript 1.6.2\n(function() {\n  var applyChange;\n\n  applyChange = function(doc, oldval, newval) {\n    var commonEnd, commonStart;\n\n    if (oldval === newval) {\n      return;\n    }\n    commonStart = 0;\n    while (oldval.charAt(commonStart) === newval.charAt(commonStart)) {\n      commonStart++;\n    }\n    commonEnd = 0;\n    while (oldval.charAt(oldval.length - 1 - commonEnd) === newval.charAt(newval.length - 1 - commonEnd) && commonEnd + commonStart < oldval.length && commonEnd + commonStart < newval.length) {\n      commonEnd++;\n    }\n    if (oldval.length !== commonStart + commonEnd) {\n      doc.del(commonStart, oldval.length - commonStart - commonEnd);\n    }\n    if (newval.length !== commonStart + commonEnd) {\n      return doc.insert(commonStart, newval.slice(commonStart, newval.length - commonEnd));\n    }\n  };\n\n  sharejs.extendDoc('attach_textarea', function(elem) {\n    var delete_listener, doc, event, genOp, insert_listener, prevvalue, replaceText, _i, _len, _ref,\n      _this = this;\n\n    doc = this;\n    elem.value = this.getText();\n    prevvalue = elem.value;\n    replaceText = function(newText, transformCursor) {\n      var newSelection, scrollTop;\n\n      newSelection = [transformCursor(elem.selectionStart), transformCursor(elem.selectionEnd)];\n      scrollTop = elem.scrollTop;\n      elem.value = newText;\n      if (elem.scrollTop !== scrollTop) {\n        elem.scrollTop = scrollTop;\n      }\n      if (window.document.activeElement === elem) {\n        return elem.selectionStart = newSelection[0], elem.selectionEnd = newSelection[1], newSelection;\n      }\n    };\n    this.on('insert', insert_listener = function(pos, text) {\n      var transformCursor;\n\n      transformCursor = function(cursor) {\n        if (pos < cursor) {\n          return cursor + text.length;\n        } else {\n          return cursor;\n        }\n      };\n      prevvalue = elem.value.replace(/\\r\\n/g, '\\n');\n      return replaceText(prevvalue.slice(0, pos) + text + prevvalue.slice(pos), transformCursor);\n    });\n    this.on('delete', delete_listener = function(pos, text) {\n      var transformCursor;\n\n      transformCursor = function(cursor) {\n        if (pos < cursor) {\n          return cursor - Math.min(text.length, cursor - pos);\n        } else {\n          return cursor;\n        }\n      };\n      prevvalue = elem.value.replace(/\\r\\n/g, '\\n');\n      return replaceText(prevvalue.slice(0, pos) + prevvalue.slice(pos + text.length), transformCursor);\n    });\n    genOp = function(event) {\n      var onNextTick;\n\n      onNextTick = function(fn) {\n        return setTimeout(fn, 0);\n      };\n      return onNextTick(function() {\n        if (elem.value !== prevvalue) {\n          prevvalue = elem.value;\n          return applyChange(doc, doc.getText(), elem.value.replace(/\\r\\n/g, '\\n'));\n        }\n      });\n    };\n    _ref = ['textInput', 'keydown', 'keyup', 'select', 'cut', 'paste'];\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      event = _ref[_i];\n      if (elem.addEventListener) {\n        elem.addEventListener(event, genOp, false);\n      } else {\n        elem.attachEvent('on' + event, genOp);\n      }\n    }\n    return elem.detach_share = function() {\n      var _j, _len1, _ref1, _results;\n\n      _this.removeListener('insert', insert_listener);\n      _this.removeListener('delete', delete_listener);\n      _ref1 = ['textInput', 'keydown', 'keyup', 'select', 'cut', 'paste'];\n      _results = [];\n      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {\n        event = _ref1[_j];\n        if (elem.removeEventListener) {\n          _results.push(elem.removeEventListener(event, genOp, false));\n        } else {\n          _results.push(elem.detachEvent('on' + event, genOp));\n        }\n      }\n      return _results;\n    };\n  });\n\n}).call(this);\n"]},"hash":"615e609c703bf163dd2163e20a371d0bd242342a"}
